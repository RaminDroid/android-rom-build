name: Android ROM Build

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Install Dependencies
        run: |
          sudo apt update
          sudo apt install git-core gnupg flex bison build-essential zip curl zlib1g-dev gcc-multilib g++-multilib \
          libc6-dev-i386 lib32ncurses5-dev x11proto-core-dev libx11-dev lib32z-dev ccache libgl1-mesa-dev \
          libxml2-utils xsltproc unzip fontconfig -y

      - name: Setup Repo
        run: |
          mkdir ~/rom && cd ~/rom
          git config --global user.name "Orbit Tech"
          git config --global user.email "orbit@tech.com"
          curl https://storage.googleapis.com/git-repo-downloads/repo > repo
          chmod a+x repo
          sudo mv repo /usr/local/bin/

      - name: Sync ROM Source
        run: |
          cd ~/rom
          repo init -u https://github.com/LineageOS/android.git -b lineage-20.0
          repo sync --force-sync --no-tags --no-clone-bundle -j$(nproc --all)

      - name: Build ROM
        run: |
          cd ~/rom
          source build/envsetup.sh
          lunch lineage_a30-userdebug
          mka bacon -j$(nproc --all)
